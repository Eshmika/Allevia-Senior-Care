<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Setup - Allevia Senior Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
      }
      .input-field {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        margin-top: 0.25rem;
        outline: none;
        transition: all 0.2s;
      }
      .input-field:focus {
        border-color: #65c027;
        box-shadow: 0 0 0 3px rgba(101, 192, 39, 0.1);
      }
      .btn-primary {
        background-color: #65c027;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: background-color 0.2s;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
      }
      .btn-primary:hover {
        background-color: #54a020;
      }
      .btn-primary:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4">
    <div
      class="max-w-2xl w-full bg-white rounded-2xl shadow-xl overflow-hidden"
    >
      <!-- Header -->
      <div class="bg-[#65c027] p-8 text-center">
        <h1 class="text-3xl font-bold text-white mb-2">Payment Setup</h1>
        <p class="text-green-50">Securely provide your payment details</p>
      </div>

      <div class="p-8">
        <form
          id="paymentForm"
          onsubmit="submitPayment(event)"
          class="space-y-6"
        >
          <input type="hidden" name="caregiverId" value="<?= caregiverId ?>" />

          <!-- Payment Method -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Payment Method <span class="text-red-500">*</span></label
            >
            <select
              name="paymentMethod"
              id="paymentMethod"
              required
              class="input-field bg-white"
              onchange="toggleBankFields()"
            >
              <option value="">Select a method...</option>
              <option value="Direct Deposit">Direct Deposit</option>
              <option value="Bank Deposit">Bank Deposit</option>
              <option value="Zelle">Zelle</option>
              <option value="Apple Pay">Apple Pay</option>
              <option value="Check">Check</option>
              <option value="Cash">Cash</option>
            </select>
          </div>

          <!-- Bank Details Section -->
          <div
            id="bankDetails"
            class="hidden space-y-6 border-t border-gray-100 pt-6"
          >
            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
              <i class="ph ph-bank text-[#65c027]"></i> Bank Information
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700"
                  >Bank Name <span class="text-red-500">*</span></label
                >
                <input
                  type="text"
                  name="bankName"
                  id="bankName"
                  class="input-field"
                />
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700"
                  >Full Account Holder Name
                  <span class="text-red-500">*</span></label
                >
                <input
                  type="text"
                  name="holderName"
                  id="holderName"
                  class="input-field"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Account Type <span class="text-red-500">*</span></label
                >
                <select
                  name="accountType"
                  id="accountType"
                  class="input-field bg-white"
                >
                  <option value="Checking">Checking</option>
                  <option value="Savings">Savings</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Holder Type <span class="text-red-500">*</span></label
                >
                <select
                  name="holderType"
                  id="holderType"
                  class="input-field bg-white"
                >
                  <option value="Personal">Personal</option>
                  <option value="Business">Business</option>
                </select>
              </div>

              <!-- Account Number -->
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Account Number <span class="text-red-500">*</span></label
                >
                <input
                  type="password"
                  name="accountNum"
                  id="accountNum"
                  class="input-field"
                  onpaste="return false;"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Confirm Account Number
                  <span class="text-red-500">*</span></label
                >
                <input
                  type="text"
                  id="accountNumConfirm"
                  class="input-field"
                  onpaste="return false;"
                />
              </div>

              <!-- Routing Number -->
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Routing Number <span class="text-red-500">*</span></label
                >
                <input
                  type="password"
                  name="routingNum"
                  id="routingNum"
                  class="input-field"
                  maxlength="9"
                  onpaste="return false;"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Confirm Routing Number
                  <span class="text-red-500">*</span></label
                >
                <input
                  type="text"
                  id="routingNumConfirm"
                  class="input-field"
                  maxlength="9"
                  onpaste="return false;"
                />
              </div>
            </div>
          </div>

          <!-- Zelle/Apple Pay Details -->
          <div
            id="digitalDetails"
            class="hidden space-y-4 border-t border-gray-100 pt-6"
          >
            <div class="bg-blue-50 p-4 rounded-lg text-blue-800 text-sm">
              Please confirm your full name phone number or email associated
              with your Zelle or Apple Pay
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Account Details <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                name="digitalAccountDetails"
                id="digitalAccountDetails"
                class="input-field"
                placeholder="Enter Full Name, Phone, or Email"
              />
            </div>
          </div>

          <!-- Check Details Section -->
          <div
            id="checkDetails"
            class="hidden space-y-6 border-t border-gray-100 pt-6"
          >
            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
              <i class="ph ph-file-text text-[#65c027]"></i> Check Payment
              Requirements
            </h3>
            <div class="bg-blue-50 p-4 rounded-lg text-blue-800 text-sm mb-4">
              To set up payment by check, please upload the following documents.
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Government-Issued ID (Front Only)
                <span class="text-red-500">*</span></label
              >
              <input
                type="file"
                name="checkIdUpload"
                id="checkIdUpload"
                class="input-field"
                accept="image/*,application/pdf"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Proof of Mailing Address
                <span class="text-red-500">*</span></label
              >
              <p class="text-xs text-gray-500 mb-2">
                Utility bill, lease, bank statement, or official mail dated
                within 60 days.
              </p>
              <input
                type="file"
                name="checkAddressUpload"
                id="checkAddressUpload"
                class="input-field"
                accept="image/*,application/pdf"
              />
            </div>
          </div>

          <div class="pt-6">
            <button type="submit" id="submitBtn" class="btn-primary">
              <span>Submit Payment Details</span>
              <i class="ph ph-paper-plane-right text-xl"></i>
            </button>
          </div>
        </form>
      </div>

      <div
        class="bg-gray-50 p-4 text-center text-xs text-gray-500 border-t border-gray-100"
      >
        &copy; 2025 Allevia Senior Care. Secure Form.
      </div>
    </div>

    <script>
      function toggleBankFields() {
        const method = document.getElementById("paymentMethod").value;
        const bankSection = document.getElementById("bankDetails");
        const digitalSection = document.getElementById("digitalDetails");
        const checkSection = document.getElementById("checkDetails");
        const digitalInput = document.getElementById("digitalAccountDetails");

        // Reset required attributes
        const bankInputs = bankSection.querySelectorAll("input, select");
        bankInputs.forEach((input) => (input.required = false));
        if (digitalInput) digitalInput.required = false;
        const checkInputs = checkSection.querySelectorAll("input");
        checkInputs.forEach((input) => (input.required = false));

        if (["Direct Deposit", "Bank Deposit"].includes(method)) {
          bankSection.classList.remove("hidden");
          digitalSection.classList.add("hidden");
          checkSection.classList.add("hidden");
          bankInputs.forEach((input) => (input.required = true));
        } else if (["Zelle", "Apple Pay"].includes(method)) {
          bankSection.classList.add("hidden");
          digitalSection.classList.remove("hidden");
          checkSection.classList.add("hidden");
          if (digitalInput) digitalInput.required = true;
        } else if (method === "Check") {
          bankSection.classList.add("hidden");
          digitalSection.classList.add("hidden");
          checkSection.classList.remove("hidden");
          checkInputs.forEach((input) => (input.required = true));
        } else {
          bankSection.classList.add("hidden");
          digitalSection.classList.add("hidden");
          checkSection.classList.add("hidden");
        }
      }

      function submitPayment(e) {
        e.preventDefault();

        const method = document.getElementById("paymentMethod").value;

        if (["Direct Deposit", "Bank Deposit"].includes(method)) {
          const acc = document.getElementById("accountNum").value;
          const accConf = document.getElementById("accountNumConfirm").value;
          const rout = document.getElementById("routingNum").value;
          const routConf = document.getElementById("routingNumConfirm").value;

          if (acc !== accConf) {
            Swal.fire("Error", "Account Numbers do not match.", "error");
            return;
          }
          if (rout !== routConf) {
            Swal.fire("Error", "Routing Numbers do not match.", "error");
            return;
          }
        }

        const btn = document.getElementById("submitBtn");
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML =
          '<i class="ph ph-spinner animate-spin text-xl"></i> Processing...';

        const form = document.getElementById("paymentForm");

        google.script.run
          .withSuccessHandler((res) => {
            if (res.success) {
              Swal.fire({
                title: "Success!",
                text: "Payment details saved successfully.",
                icon: "success",
                confirmButtonColor: "#65c027",
              }).then(() => {
                document.body.innerHTML = `
                  <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center">
                      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="ph ph-check text-4xl text-[#65c027]"></i>
                      </div>
                      <h2 class="text-2xl font-bold text-gray-800 mb-2">Thank You!</h2>
                      <p class="text-gray-600">Your payment information has been securely recorded.</p>
                    </div>
                  </div>
                `;
              });
            } else {
              Swal.fire("Error", res.message, "error");
              btn.disabled = false;
              btn.innerHTML = originalText;
            }
          })
          .withFailureHandler((err) => {
            Swal.fire("Error", err.message, "error");
            btn.disabled = false;
            btn.innerHTML = originalText;
          })
          .submitPaymentDetails(form);
      }
    </script>
  </body>
</html>
